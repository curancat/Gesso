<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tavares gessos</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    :root {
      --primary-color: #0d6efd; 
      --secondary-color: #f0f2f5;
      --gold: #ffc107;
    }

    body {
      background-color: var(--secondary-color);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding-bottom: 50px;
    }

    /* Header */
    .hero-header {
      background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1594916307399-5d2b70449553?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 50px 20px;
      text-align: center;
      border-radius: 0 0 30px 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    /* Menu Grid */
    .menu-btn {
      background: white;
      border: none;
      border-radius: 15px;
      padding: 25px;
      width: 100%;
      height: 100%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      transition: all 0.2s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
    }
    
    .menu-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      background-color: #f8f9fa;
    }

    .menu-icon {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    /* Avalia√ß√µes */
    .star-rating {
      color: #ddd;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .star-rating.checked {
      color: var(--gold);
    }

    /* Chat Interno */
    .chat-box {
      height: 300px;
      overflow-y: auto;
      background: #e9ecef;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .message-bubble {
      background: white;
      padding: 8px 12px;
      border-radius: 10px;
      margin-bottom: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .msg-admin {
      background: #d1e7dd;
      text-align: right;
      margin-left: 20%;
    }

    /* Footer Admin Link */
    .admin-link {
      position: fixed;
      bottom: 10px;
      right: 10px;
      opacity: 0.3;
      font-size: 0.8rem;
      color: #333;
      cursor: pointer;
    }
    .admin-link:hover { opacity: 1; }

  </style>
</head>
<body>

  <div class="hero-header">
    <h1><i class="fas fa-hammer"></i> Gesso & Drywall</h1>
    <p class="lead">Qualidade e confian√ßa na sua obra</p>
  </div>

  <div class="container">
    
    <div class="row row-cols-2 row-cols-md-4 g-3 mb-5">
      <div class="col">
        <button class="menu-btn" data-bs-toggle="modal" data-bs-target="#orderModal">
          <i class="fas fa-clipboard-list menu-icon"></i>
          <h6 class="fw-bold m-0">contratar</h6>
        </button>
      </div>

      <div class="col">
        <button class="menu-btn" onclick="abrirAvaliacoes()">
          <i class="fas fa-star menu-icon text-warning"></i>
          <h6 class="fw-bold m-0">Avalia√ß√µes</h6>
        </button>
      </div>

      <div class="col">
        <button class="menu-btn" data-bs-toggle="modal" data-bs-target="#pixModal">
          <i class="fas fa-qrcode menu-icon text-success"></i>
          <h6 class="fw-bold m-0">Pagar com Pix</h6>
        </button>
      </div>

      <div class="col">
        <button class="menu-btn" data-bs-toggle="modal" data-bs-target="#contactChoiceModal">
          <i class="fas fa-comments menu-icon text-info"></i>
          <h6 class="fw-bold m-0">Fale Conosco</h6>
        </button>
      </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 p-4 text-center bg-white">
      <h5 class="text-primary">Tem d√∫vidas sobre seu projeto?</h5>
      <p class="text-muted small">garantimos especialidade e m√£o de obra proficional em cada obra</p>
    </div>

  </div>

  <div class="modal fade" id="orderModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">üìù Solicitar Servi√ßos</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="orderForm">
            <div class="mb-3">
              <label class="form-label">Nome</label>
              <input type="text" id="clientName" class="form-control" placeholder="Seu nome">
            </div>
            <div class="mb-3">
              <label class="form-label">WhatsApp</label>
              <input type="tel" id="clientPhone" class="form-control" placeholder="(00) 00000-0000">
            </div>
            <div class="mb-3">
              <label class="form-label">Endere√ßo da Obra</label>
              <input type="text" id="clientAddress" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Descri√ß√£o do Servi√ßo</label>
              <textarea id="clientDesc" class="form-control" rows="3" placeholder="Ex: Teto rebaixado na sala..."></textarea>
            </div>
            <button type="button" class="btn btn-primary w-100" onclick="enviarSolicitacao()">Enviar Pedido</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="reviewsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-warning">
          <h5 class="modal-title text-dark">‚≠ê O que dizem nossos clientes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="card p-3 mb-3 border-light shadow-sm">
            <h6>Deixe sua avalia√ß√£o:</h6>
            <div class="mb-2" id="star-container">
              <i class="fas fa-star star-rating" onclick="setStar(1)"></i>
              <i class="fas fa-star star-rating" onclick="setStar(2)"></i>
              <i class="fas fa-star star-rating" onclick="setStar(3)"></i>
              <i class="fas fa-star star-rating" onclick="setStar(4)"></i>
              <i class="fas fa-star star-rating" onclick="setStar(5)"></i>
            </div>
            <input type="text" id="reviewName" class="form-control form-control-sm mb-2" placeholder="Seu Nome">
            <textarea id="reviewText" class="form-control form-control-sm mb-2" placeholder="Coment√°rio..."></textarea>
            <button class="btn btn-sm btn-dark" onclick="enviarAvaliacao()">Publicar</button>
          </div>
          <hr>
          <div id="reviews-list">Carregando...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="pixModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-header border-0">
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body pb-5">
          <i class="fab fa-pix text-success" style="font-size: 4rem;"></i>
          <h3 class="mt-3">Pagamento via Pix</h3>
          <p class="text-muted">Copie a chave abaixo para realizar o pagamento do sinal ou servi√ßo.</p>
          
          <div class="input-group mb-3 mt-4">
            <input type="text" class="form-control text-center bg-white" id="pixKey" value="Carregando..." readonly>
            <button class="btn btn-outline-success" onclick="copiarPix()"><i class="fas fa-copy"></i> Copiar</button>
          </div>
          
          <small class="text-info" id="copyMsg" style="display:none;">Chave copiada!</small>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="contactChoiceModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Fale Conosco</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <p>Como prefere ser atendido?</p>
          <div class="d-grid gap-3">
            <a href="#" id="btnWhatsappAction" target="_blank" class="btn btn-success btn-lg">
              <i class="fab fa-whatsapp"></i> Ir para WhatsApp
            </a>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#chatModal">
              <i class="fas fa-comments"></i> Chat do Site
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Chat Online</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="chat-display" class="chat-box"></div>
          <div class="input-group">
            <input type="text" id="chatUser" class="form-control" placeholder="Seu nome" style="max-width: 30%;">
            <input type="text" id="chatMsg" class="form-control" placeholder="Mensagem...">
            <button class="btn btn-primary" onclick="enviarMensagemChat()">Enviar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="adminLoginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">√Årea Restrita üîí</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="password" id="adminPass" class="form-control mb-3" placeholder="Senha do Gesseiro">
          <button class="btn btn-dark w-100" onclick="verificarSenhaAdmin()">Entrar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="adminDashboardModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-dark text-white">
          <h5 class="modal-title">üõ†Ô∏è Painel do Gesseiro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          
          <ul class="nav nav-tabs mb-3" id="adminTabs" role="tablist">
            <li class="nav-item">
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-fila">üìã Pedidos</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-chat">üí¨ Chat</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-config">‚öôÔ∏è Configura√ß√µes</button>
            </li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-fila">
              <button class="btn btn-sm btn-outline-secondary mb-3" onclick="atualizarFilaAdmin()">üîÑ Atualizar</button>
              <div id="admin-queue-container">Carregando...</div>
            </div>
            
            <div class="tab-pane fade" id="tab-chat">
                <p class="text-muted">Mensagens dos clientes:</p>
                <div id="admin-chat-display" class="bg-light p-3 border rounded" style="max-height: 300px; overflow-y: auto;">
                    Carregando mensagens...
                </div>
            </div>

            <div class="tab-pane fade" id="tab-config">
              <div class="card p-4 border-0 shadow-sm bg-light">
                <h5 class="mb-4">Dados de Contato e Pagamento</h5>
                
                <div class="mb-3">
                  <label class="form-label fw-bold">üîë Chave Pix (Copia e Cola)</label>
                  <input type="text" id="configPix" class="form-control" placeholder="Ex: 123.456.789-00 ou email@email.com">
                  <small class="text-muted">Essa chave aparecer√° para o cliente copiar.</small>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-bold">üì± WhatsApp de Atendimento</label>
                  <input type="text" id="configZap" class="form-control" placeholder="Ex: 11999998888">
                  <small class="text-muted">Apenas n√∫meros com DDD. O bot√£o do site abrir√° esse n√∫mero.</small>
                </div>

                <button class="btn btn-success w-100" onclick="salvarConfiguracoesAdmin()">
                  <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
              </div>
            </div>

          </div>

        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Sair do Painel</button>
        </div>
      </div>
    </div>
  </div>

  <div class="admin-link" data-bs-toggle="modal" data-bs-target="#adminLoginModal">
    <i class="fas fa-lock"></i> Acesso Gesseiro
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, push, get, remove, onChildAdded, set } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    // --- CONFIGURA√á√ÉO FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyCGg6A_HNAJ0qsB4gzYJgQK9E3ztISO-FM",
      authDomain: "cardapio-1d6f1.firebaseapp.com",
      projectId: "cardapio-1d6f1",
      storageBucket: "cardapio-1d6f1.firebasestorage.app",
      messagingSenderId: "841755407374",
      appId: "1:841755407374:web:115d312d354bb6e77df85f"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // --- Vari√°veis Globais ---
    let currentRating = 0;
    const SENHA_ADMIN = "172348"; 

    // --- CARREGAMENTO INICIAL (Configura√ß√µes) ---
    window.onload = function() {
        carregarConfiguracoesGerais();
    };

    function carregarConfiguracoesGerais() {
        // Pega as configura√ß√µes do Firebase
        get(ref(database, 'configuracoes_loja')).then((snapshot) => {
            if(snapshot.exists()) {
                const config = snapshot.val();
                
                // Atualiza Pix
                if(config.pix) {
                    const pixInput = document.getElementById('pixKey');
                    if(pixInput) pixInput.value = config.pix;
                }

                // Atualiza Bot√£o WhatsApp
                if(config.whatsapp) {
                    const zapBtn = document.getElementById('btnWhatsappAction');
                    const cleanNumber = config.whatsapp.replace(/\D/g, ''); // Remove caracteres n√£o num√©ricos
                    if(zapBtn) zapBtn.href = `https://wa.me/55${cleanNumber}`;
                }
            } else {
                // Valores padr√£o caso n√£o tenha nada salvo
                document.getElementById('pixKey').value = "Chave n√£o configurada";
            }
        });
    }

    // --- 1. PEDIDOS ---
    window.enviarSolicitacao = function() {
        const nome = document.getElementById('clientName').value;
        const phone = document.getElementById('clientPhone').value;
        const endereco = document.getElementById('clientAddress').value;
        const desc = document.getElementById('clientDesc').value;

        if(!nome || !phone || !desc) {
            alert("Preencha Nome, WhatsApp e Descri√ß√£o.");
            return;
        }

        push(ref(database, 'servicos_gesso'), {
            cliente: nome,
            telefone: phone,
            endereco: endereco,
            descricao: desc,
            timestamp: Date.now()
        }).then(() => {
            alert("‚úÖ Or√ßamento solicitado com sucesso!");
            document.getElementById('orderForm').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('orderModal'));
            modal.hide();
        });
    }

    // --- 2. AVALIA√á√ïES ---
    window.setStar = function(n) {
        currentRating = n;
        const stars = document.querySelectorAll('#star-container .star-rating');
        stars.forEach((s, index) => {
            if(index < n) s.classList.add('checked', 'text-warning');
            else s.classList.remove('checked', 'text-warning');
        });
    }

    window.enviarAvaliacao = function() {
        const nome = document.getElementById('reviewName').value;
        const texto = document.getElementById('reviewText').value;

        if(!nome || currentRating === 0) {
            alert("D√™ uma nota e diga seu nome!");
            return;
        }

        push(ref(database, 'avaliacoes'), {
            nome: nome,
            estrelas: currentRating,
            comentario: texto,
            timestamp: Date.now()
        }).then(() => {
            document.getElementById('reviewName').value = "";
            document.getElementById('reviewText').value = "";
            setStar(0); 
            carregarAvaliacoes(); 
        });
    }

    window.abrirAvaliacoes = function() {
        const modal = new bootstrap.Modal(document.getElementById('reviewsModal'));
        modal.show();
        carregarAvaliacoes();
    }

    function carregarAvaliacoes() {
        const list = document.getElementById('reviews-list');
        list.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        
        get(ref(database, 'avaliacoes')).then((snapshot) => {
            list.innerHTML = '';
            if(!snapshot.exists()) {
                list.innerHTML = '<p class="text-muted text-center">Seja o primeiro a avaliar!</p>';
                return;
            }
            
            const reviews = [];
            snapshot.forEach(child => reviews.push(child.val()));
            reviews.reverse();

            reviews.forEach(rev => {
                let starsHTML = '';
                for(let i=0; i<5; i++) {
                    starsHTML += i < rev.estrelas ? '<i class="fas fa-star text-warning"></i>' : '<i class="fas fa-star text-light"></i>';
                }

                list.innerHTML += `
                    <div class="mb-3 border-bottom pb-2">
                        <div class="d-flex justify-content-between">
                            <strong>${rev.nome}</strong>
                            <small>${starsHTML}</small>
                        </div>
                        <p class="mb-0 small text-secondary">${rev.comentario}</p>
                    </div>
                `;
            });
        });
    }

    // --- 3. PAGAMENTO PIX ---
    window.copiarPix = function() {
        const copyText = document.getElementById("pixKey");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value);
        
        const msg = document.getElementById("copyMsg");
        msg.style.display = "block";
        setTimeout(() => msg.style.display = "none", 2000);
    }

    // --- 4. CHAT ---
    function appendMessage(data, containerId) {
        const container = document.getElementById(containerId);
        const time = new Date(data.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        container.innerHTML += `
            <div class="message-bubble">
                <strong class="text-primary">${data.usuario}:</strong> ${data.texto}
                <br><span class="text-muted" style="font-size:0.7rem">${time}</span>
            </div>
        `;
        container.scrollTop = container.scrollHeight;
    }

    onChildAdded(ref(database, 'mensagens_chat'), (data) => {
        const msg = data.val();
        if(document.getElementById('chatModal').classList.contains('show')) {
             appendMessage(msg, 'chat-display');
        }
    });

    window.enviarMensagemChat = function() {
        const user = document.getElementById('chatUser').value || "Cliente An√¥nimo";
        const text = document.getElementById('chatMsg').value;
        if(!text) return;

        push(ref(database, 'mensagens_chat'), {
            usuario: user,
            texto: text,
            timestamp: Date.now()
        });
        document.getElementById('chatMsg').value = '';
    }

    // --- 5. √ÅREA DO GESSEIRO (ADMIN) ---
    
    window.verificarSenhaAdmin = function() {
        const pass = document.getElementById('adminPass').value;
        if(pass === SENHA_ADMIN) {
            const modalLogin = bootstrap.Modal.getInstance(document.getElementById('adminLoginModal'));
            modalLogin.hide();
            const modalDash = new bootstrap.Modal(document.getElementById('adminDashboardModal'));
            modalDash.show();
            
            // Carrega tudo
            atualizarFilaAdmin();
            carregarChatAdmin();
            carregarConfigsNoInput();
        } else {
            alert("Senha incorreta!");
        }
    }

    // Carrega os valores atuais para os inputs do painel admin
    function carregarConfigsNoInput() {
         get(ref(database, 'configuracoes_loja')).then((snapshot) => {
            if(snapshot.exists()) {
                const config = snapshot.val();
                if(config.pix) document.getElementById('configPix').value = config.pix;
                if(config.whatsapp) document.getElementById('configZap').value = config.whatsapp;
            }
         });
    }

    // Salva os novos valores no Firebase
    window.salvarConfiguracoesAdmin = function() {
        const pix = document.getElementById('configPix').value;
        const zap = document.getElementById('configZap').value;

        set(ref(database, 'configuracoes_loja'), {
            pix: pix,
            whatsapp: zap
        }).then(() => {
            alert("‚úÖ Configura√ß√µes salvas! O site j√° foi atualizado.");
            // Recarrega as configura√ß√µes globais para testar imediatamente
            carregarConfiguracoesGerais();
        }).catch((e) => {
            alert("Erro ao salvar: " + e.message);
        });
    }

    window.atualizarFilaAdmin = function() {
        const container = document.getElementById('admin-queue-container');
        container.innerHTML = 'Carregando...';
        
        get(ref(database, 'servicos_gesso')).then((snapshot) => {
            container.innerHTML = '';
            if(!snapshot.exists()) {
                container.innerHTML = '<p>Nenhum pedido pendente.</p>'; 
                return;
            }

            snapshot.forEach((child) => {
                const key = child.key;
                const dados = child.val();
                const zapLink = `https://wa.me/55${dados.telefone.replace(/\D/g, '')}`;

                container.innerHTML += `
                    <div class="card mb-2 border-primary">
                        <div class="card-body py-2">
                            <h6 class="fw-bold">${dados.cliente} <small class="text-muted fw-normal">(${dados.telefone})</small></h6>
                            <p class="small mb-1">${dados.descricao}</p>
                            <p class="small mb-2 text-muted"><i class="fas fa-map-marker-alt"></i> ${dados.endereco}</p>
                            <div class="d-flex gap-2">
                                <a href="${zapLink}" target="_blank" class="btn btn-sm btn-success"><i class="fab fa-whatsapp"></i> Chamar</a>
                                <button class="btn btn-sm btn-outline-danger" onclick="apagarPedido('${key}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            });
        });
    }

    window.apagarPedido = function(key) {
        if(confirm("Remover este pedido da fila?")) {
            remove(ref(database, `servicos_gesso/${key}`))
            .then(() => atualizarFilaAdmin());
        }
    }

    window.carregarChatAdmin = function() {
        const container = document.getElementById('admin-chat-display');
        container.innerHTML = 'Carregando hist√≥rico...';
        
        get(ref(database, 'mensagens_chat')).then((snapshot) => {
            container.innerHTML = '';
            if(!snapshot.exists()) {
                container.innerHTML = 'Nenhuma mensagem.';
                return;
            }
            snapshot.forEach((child) => {
                const msg = child.val();
                appendMessage(msg, 'admin-chat-display');
            });
            container.scrollTop = container.scrollHeight;
        });
    }

  </script>
</body>
</html>
